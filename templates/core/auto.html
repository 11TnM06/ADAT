{% extends 'extensions/base.html' %}
{% load static %}
{% block stylesheets %}
    <link rel="stylesheet" type="text/css" href="{% static '/assets/css/metasploit/exploit.css' %}">
{% endblock stylesheets %}

{% block content %}
    <div class="container mt-5">
        <div class="row">
            <div class="col">
                <h2 class="mb-4 section-name">Exploit Metasploit: {{ name }}</h2>
                <form id="create_target">
                    <div class="row mb-3">
                        <div class="col">
                            <input type="text" class="form-control border-bottom-only" placeholder="Host Name"
                                   id="hostname" name="hostname" value="{{ host }}" required/>
                        </div>
                        <div class="col">
                            <input type="text" class="form-control border-bottom-only" placeholder="Target URI"
                                   id="targeturi" name="targeturi" required/>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col">
                            <select class="form-select border-bottom-only" placeholder="modules_list" id="modules_list"
                                    name="module_lists" required>
{#                                <option value="" hidden selected disabled>Please select exploit module</option>#}
                                {% for exploit in exploits %}
                                    <option value="{{ exploit.module }}">{{ exploit.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col">
                            <select class="form-select border-bottom-only" placeholder="payload" id="payload"
                                name="payload" required>
                            <option value="" hidden selected disabled>Please select payload</option>
                            {% for child in payloads_list %}
                                <option value="{{ child.id }}">{{ child.name }}</option>
                            {% endfor %}
                        </select>
                        </div>
                    </div>
                </form>
                <button type="button" class="btn btn-primary"
                        onclick="if(confirm('Are you sure you want to exploit?')) exploit()">Exploit
                </button>
            </div>
        </div>
    </div>
{% endblock content %}

{% block javascripts %}
    <script>
        async function exploit() {
            {#var token = "{{ csrf_token }}";#}
            {#var target_id = event.target.id;#}
            {#var url = '/gvm/target/' + target_id;#}
            {#var response = await fetch(url, {#}
            {#    method: 'DELETE',#}
            {#    headers: {#}
            {#        'Content-Type': 'application/json',#}
            {#        'X-CSRFToken': token#}
            {#    }#}
            {#}).then((response) => response.json());#}
            {#if (response.status == "200") {#}
            {#    document.getElementById("create_target").reset();#}
            {#    alert('Code: ' + response.status + "\n\n" + "Message: " + response.status_text);#}
            {#    const targetElement = document.getElementById(`target_${target_id}`);#}
            {#    if (targetElement) {#}
            {#        targetElement.remove();#}
            {#    } else {#}
            {#        alert('Update Target List Error');#}
            {#    }#}
            {#} else {#}
            {#    alert('Error Code: ' + response.status + "\n\n" + "Message: " + response.status_text);#}
            {#}#}
        }
    </script>
{% endblock javascripts %}
